import java.nio.charset.StandardCharsets

/*
 * This file was generated by the Gradle "init" task.
 */
plugins {
    id "java"
    id "idea"
    id "java-library"
    id "maven-publish"
    id "io.papermc.paperweight.userdev" version "1.7.1"
    id "xyz.jpenilla.run-paper" version "2.2.2" // Adds runServer and runMojangMappedServer tasks for testing
    id "org.jetbrains.kotlin.jvm" version "1.9.22"
    id "io.github.goooler.shadow" version "8.1.8"
}

repositories {
    mavenCentral()
    gradlePluginPortal()
    maven {
        url = uri("https://jitpack.io")
    }
    maven {
        url = uri("https://repo.papermc.io/repository/maven-public/")
    }
    maven {
        url = uri("https://oss.sonatype.org/content/groups/public/")
    }
    maven {
        url = uri("https://ci.mg-dev.eu/plugin/repository/everything")
    }
    maven {
        url = uri("https://ci.mg-dev.eu/plugin/repository/everything/")
    }
    maven {
        url = uri("https://m2.dv8tion.net/releases")
    }
    maven {
        url = uri("https://repo.dmulloy2.net/repository/public/")
    }
    maven {
        url = uri("https://repo.maven.apache.org/maven2/")
    }
    maven {
        url = uri("https://repo.codemc.io/repository/maven-releases/")
    }
    maven {
        url = uri('https://mvn.lumine.io/repository/maven-public/')
    }
    maven {
        url = uri("https://repo.dmulloy2.net/repository/public/")
    }
    maven {
        url = uri("https://repo.flyte.gg/releases")
    }
}

dependencies {
    api "org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"
    api "net.kyori:adventure-text-minimessage:4.14.0"
    api "org.joml:joml:1.10.5"
    api "org.apache.commons:commons-math3:3.6.1"

    compileOnly "com.bergerkiller.bukkit:TrainCarts:1.20.4-v1-SNAPSHOT"
    compileOnly "com.bergerkiller.bukkit:TCCoasters:1.20.4-v1-SNAPSHOT"
    compileOnly "com.fastasyncworldedit:FastAsyncWorldEdit-Core:2.8.2"
    compileOnly "com.fastasyncworldedit:FastAsyncWorldEdit-Bukkit:2.8.2"
    compileOnly 'com.github.Mindgamesnl.OpenAudioMc:openaudiomc-api:6.10.1'
    compileOnly 'com.ticxo.modelengine:ModelEngine:R4.0.4'
    compileOnly 'com.comphenix.protocol:ProtocolLib:4.7.0'

    shadow "me.m56738:SmoothCoastersAPI:1.10"
    shadow "com.opencsv:opencsv:5.9"
    shadow "com.jeff-media:custom-block-data:2.2.2"
    shadow 'org.jsoup:jsoup:1.17.2'
    shadow 'fr.mrmicky:fastboard:2.0.2'
    shadow 'com.github.patheloper.pathetic:pathetic-mapping:2.3'
    shadow 'gg.flyte:twilight:1.1.12'

    implementation "net.dv8tion:JDA:5.0.0-beta.23" // "Shadowed" via plugin libraries in the plugin.yml
    implementation 'club.minnced:jda-ktx:0.11.0-beta.20'
    implementation 'com.github.M64DiamondStar:EffectMaster:f47e6278df'

    paperweight.paperDevBundle "1.21-R0.1-SNAPSHOT"
}

group = "me.m64diamondstar"
version = "1.0"
description = "IngeniaMC-Core"
java.sourceCompatibility = JavaVersion.VERSION_21
//paperweight.reobfArtifactConfiguration = io.papermc.paperweight.userdev.ReobfArtifactConfiguration.MOJANG_PRODUCTION

java {
    // Configure the java toolchain. This allows gradle to auto-provision JDK 21 on systems that only have JDK 11 installed for example.
    sourceCompatibility = "21"
    targetCompatibility = "21"
    toolchain.languageVersion = JavaLanguageVersion.of(21)
}

tasks {
    compileJava {
        options.encoding = StandardCharsets.UTF_8.name() // We want UTF-8 for everything

        // Set the release flag. This configures what version bytecode the compiler will emit, as well as what JDK APIs are usable.
        // See https://openjdk.java.net/jeps/247 for more information.
        options.release.set(21)
    }

    compileKotlin {
        kotlinOptions.jvmTarget = "21"
    }

    javadoc {
        options.encoding = StandardCharsets.UTF_8.name() // We want UTF-8 for everything
    }

    processResources {
        filteringCharset = "UTF-8" // We want UTF-8 for everything
        def props = [
                "name": project.name,
                "version": project.version,
                "description": project.description,
                "apiVersion": "1.20"
        ]
        inputs.properties(props)
        filesMatching("plugin.yml") {
            expand(props)
        }
    }
}

shadowJar {
    // Rename the JAR file if needed
    archiveBaseName.set("IngeniaMC-Core")
    archiveClassifier.set('')
    archiveVersion.set('')

    // Include dependencies in the fat JAR
    configurations = [project.configurations.shadow]

    // Relocate packages
    relocate 'com.jeff_media', 'me.m64diamondstar.ingeniamccore.libs.jeff_media'
    relocate 'me.m56738.SmoothCoastersAPI', 'me.m64diamondstar.ingeniamccore.libs.smoothcoasters'
    relocate 'fr.mrmicky.fastboard', 'me.m64diamondstar.fastboard'
    relocate 'com.github.patheloper.pathetic.pathetic-mapping', 'me.m64diamondstar.ingeniamccore.libs.pathetic'
    relocate 'gg.flyte.twilight', 'me.m64diamondstar.ingeniamccore.libs.twiligt'
}

idea {
    module {
        downloadJavadoc = true
        downloadSources = true
    }
}